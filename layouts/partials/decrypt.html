<script>
    (function() {
        // Store the Base64-encoded decryption key and decode it in memory
        let obf = atob("INJECT_KEY_HERE_BASE64"); 

        // Provide a function to access the key securely
        window.getDecryptionKey = function() {
            return obf;
        };

        // Ensure key is available long enough for decryption, then wipe it
        setTimeout(() => {
            console.warn("Wiping decryption key...");
            obf = null;
            window.getDecryptionKey = function() { return null; };
        }, 15000); // Wipe after 15 seconds
    })();
</script>

<script>
    // DevTools detection: If opened, wipe key and disable logging
    setInterval(() => {
        if (window.outerWidth - window.innerWidth > 100 || window.outerHeight - window.innerHeight > 100) {
            console.warn("DevTools detected! Wiping decryption key...");
            window.getDecryptionKey = function() { return null; }; // Remove function reference
            console.log = function() {}; 
            console.warn = function() {};
            console.error = function() {};
        }
    }, 1000);
</script>

<script>
    // Helper function to decode Base64 to UTF-8
    function base64DecodeUnicode(str) {
        return decodeURIComponent(atob(str).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
    }
    
    // Function to decrypt content using XOR
    function decryptContent(encryptedText, key) {
        console.log("Encrypted Text (Raw):", encryptedText);

        if (!key) {
            console.error("Decryption key is missing!");
            return "Error decrypting content.";
        }

        try {
            const decodedText = base64DecodeUnicode(encryptedText);
            console.log("Decoded Text (UTF-8):", decodedText);

            let decrypted = '';
            for (let i = 0; i < decodedText.length; i++) {
                decrypted += String.fromCharCode(decodedText.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }

            console.log("Decrypted Content:", decrypted);
            return decrypted;
        } catch (e) {
            console.error("Failed to decode and decrypt content:", e);
            return "Error decrypting content.";
        }
    }

    window.onload = function () {
        const encryptedElement = document.getElementById('encrypted-content');
        if (!encryptedElement) {
            console.error("Encrypted content element not found!");
            return;
        }

        const encryptedContent = encryptedElement.textContent.trim();
        const decryptionKey = window.getDecryptionKey ? window.getDecryptionKey() : null;

        if (!decryptionKey) {
            console.error("Decryption key not available.");
            return;
        }

        const decryptedContent = decryptContent(encryptedContent, decryptionKey);
        console.log("Decrypted Content:", decryptedContent);

        // 🔹 Create a div for displaying the text with a Shadow DOM
        const hiddenDiv = document.createElement('div');
        hiddenDiv.className = "hidden-content";

        // Attach Shadow DOM (Hides spans from DevTools)
        const shadow = hiddenDiv.attachShadow({ mode: 'closed' });

        // 🔹 Split text into lines to preserve line breaks
        let lines = decryptedContent.split("\n");

        // 🔹 Format each line separately to keep text structure
        lines.forEach((line) => {
            let lineDiv = document.createElement("div");

            for (let char of line) {
                let span = document.createElement("span");
                if (/[A-Za-z]/.test(char)) {
                    span.className = "letters-font";
                } else if (/[0-9]/.test(char)) {
                    span.className = "numbers-font";
                } else {
                    span.className = "symbols-font";
                }
                span.textContent = char;
                lineDiv.appendChild(span);
            }

            shadow.appendChild(lineDiv);
        });

        // Append inside the correct container
        const container = document.querySelector(".wows-container");
        if (container) {
            container.appendChild(hiddenDiv);
        } else {
            console.warn("wows-container not found! Appending to body instead.");
            document.body.appendChild(hiddenDiv);
        }

        // Hide the original encrypted content for security
        encryptedElement.textContent = "";

        // 🔹 Inject CSS styles dynamically inside Shadow DOM
        const style = document.createElement("style");
        style.textContent = `
            .hidden-content {
                white-space: pre-wrap;
                display: block;
                padding: 10px;
                font-size: 18px;
                line-height: 1.5;
            }
            .letters-font {
                font-family: 'ShinedowLetters', Arial, sans-serif;
            }
            .numbers-font {
                font-family: 'OrbitronNumbers', sans-serif;
                font-size: 13px;
            }
            .symbols-font {
                font-family: 'OrbitronSymbols', sans-serif;
                font-size: 13px;
            }
        `;
        shadow.appendChild(style);

        // 🔹 Prevent user selection & right-click on text
        const globalStyle = document.createElement("style");
        globalStyle.textContent = `
            .hidden-content span {
                pointer-events: none; /* Blocks right-click and hover detection */
                user-select: none; /* Prevents text selection */
            }
        `;
        document.head.appendChild(globalStyle);

        // 🔹 Detect if DevTools is opened and hide spans
        setInterval(() => {
            if (window.outerWidth - window.innerWidth > 100 || window.outerHeight - window.innerHeight > 100) {
                shadow.innerHTML = "<span>🅽🅸🅲🅴 🆃🆁🆈 🫵🏻</span>"; // Replace spans when DevTools is open
            }
        }, 1000);
    };
</script>